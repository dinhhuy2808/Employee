<!DOCTYPE HTML>
<html>

<head>
    <title>ACD</title>


    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta name="keywords" content="Template, html, premium, themeforest"/>
    <meta name="description" content="Traveler - Premium template for travel companies">
    <meta name="author" content="Tsoy">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- GOOGLE FONTS -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600' rel='stylesheet'
          type='text/css'>
    <!-- /GOOGLE FONTS -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/mystyles.css">
    <script src="js/modernizr.js"></script>


</head>

<body>

<!-- FACEBOOK WIDGET -->
<div id="fb-root"></div>
<!--<script>
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>-->
<!-- /FACEBOOK WIDGET -->
<div class="global-wrap">
    <header id="main-header">
        <div class="header-top">
            <div class="container">
                <div class="row">
                    <div class="col-md-3">
                        <a class="logo" href="/">
                            <img src="img/ACD_Final_Logo_2.png" alt="Image Alternative text" title="Image Title"/>
                        </a>
                    </div>
                    <div class="col-md-3 col-md-offset-2">
                        <form class="main-header-search">
                            <div class="form-group form-group-icon-left">
                                <i class="fa fa-search input-icon"></i>
                                <input type="text" class="form-control">
                            </div>
                        </form>
                    </div>
                    <div class="col-md-4">
                        <div class="top-user-area clearfix">
                            <ul class="top-user-area-list list list-horizontal list-border">
                                <li class="top-user-area-avatar">
                                    <a href="user-profile.html">
                                        <img class="origin round" src="img/40x40.png" alt="Image Alternative text"
                                             title="AMaze"/>Hi, <%= data.fname %></a>
                                </li>
                                <li><a href="/logout">Sign Out</a>
                                </li>
                                <li class="nav-drop"><a href="#">USD $<i class="fa fa-angle-down"></i><i
                                                class="fa fa-angle-up"></i></a>
                                    <ul class="list nav-drop-menu">
                                        <li><a href="#">EUR<span class="right">€</span></a>
                                        </li>
                                        <li><a href="#">GBP<span class="right">£</span></a>
                                        </li>
                                        <li><a href="#">JPY<span class="right">円</span></a>
                                        </li>
                                        <li><a href="#">CAD<span class="right">$</span></a>
                                        </li>
                                        <li><a href="#">AUD<span class="right">A$</span></a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="top-user-area-lang nav-drop">
                                    <a href="#">
                                        <img src="img/flags/32/uk.png" alt="Image Alternative text"
                                             title="Image Title"/>ENG<i class="fa fa-angle-down"></i><i
                                                class="fa fa-angle-up"></i>
                                    </a>
                                    <ul class="list nav-drop-menu">
                                        <li>
                                            <a title="German" href="#">
                                                <img src="img/flags/32/de.png" alt="Image Alternative text"
                                                     title="Image Title"/><span class="right">GER</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a title="Japanise" href="#">
                                                <img src="img/flags/32/jp.png" alt="Image Alternative text"
                                                     title="Image Title"/><span class="right">JAP</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a title="Italian" href="#">
                                                <img src="img/flags/32/it.png" alt="Image Alternative text"
                                                     title="Image Title"/><span class="right">ITA</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a title="French" href="#">
                                                <img src="img/flags/32/fr.png" alt="Image Alternative text"
                                                     title="Image Title"/><span class="right">FRE</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a title="Russian" href="#">
                                                <img src="img/flags/32/ru.png" alt="Image Alternative text"
                                                     title="Image Title"/><span class="right">RUS</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a title="Korean" href="#">
                                                <img src="img/flags/32/kr.png" alt="Image Alternative text"
                                                     title="Image Title"/><span class="right">KOR</span>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </header>

    <div class="container">
        <h1 class="page-title">Edit Task</h1>

    </div>

    <div class="container">

        <div class="row" data-gutter="60">
            <div class="col-md-4">

                <form action="save-task" novalidate  method="post" enctype="multipart/form-data" id="frmId">

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Task Code</label>
                        <input name="taskcode" id="taskcode" value='<%= tasks[0].task_code %>' class="form-control" required >
                        <input name="task_id" id="task_id" value='<%= tasks[0].task_id %>' required style="display: none" >
                    </div>

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Desciption</label>
                        <textarea class="form-control" type="text" name="description" id="description" value='<%= tasks[0].description %>' required><%= tasks[0].description %></textarea>
                    </div>

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Assignee</label>
                        <%if(data.type == 1){%>
                        <input type="text" class="form-control" name="email" id="email" value='<%= tasks[0].assignee_email %>' required>
                        <%} else {%>
                        <select name="email" id="email" onchange="ChangeThis()">
                            <%if(tasks[0].assignee_email != null){%>

                            <option value="" ></option>

                            <option value="<%= tasks[0].assignee_email %>" selected><%= tasks[0].assignee_email %></option>
                            <%} else {%>

                            <option value="" selected></option>

                            <option value="<%= tasks[0].assignee_email %>">Assign to me</option>

                            <%}%>

                        </select>
                        <%}%>
                        <input type="text" name="assignee_id" id="assignee_id" value = '<%= tasks[0].assignee_id %>' style="display: none">
                    </div>

                    <!--<div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Email</label>
                        <input class="form-control" type="text" name="email" id="email" required>
                    </div>-->

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Assignee Name</label>
                        <input class="form-control" type="text" name="name" id="name" value='<%= tasks[0].assignee_firstname  + ' ' + tasks[0].assignee_lastname%>' disabled>
                        <input class="form-control" type="text" name="realname" id="realname" value='<%= tasks[0].assignee_firstname  + ' ' + tasks[0].assignee_lastname%>' style="display: none">
                    </div>

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Estimate</label>


                        <%if(data.type == 1){%>
                            <input class="form-control" type="text" name="estimate" id="estimate" value='<%= tasks[0].estimate %>' required>
                        <%} else {%>
                            <%if(tasks[0].approved == 'Y'){%>
                                <input class="form-control" type="text" name="estimate" id="estimate" value='<%= tasks[0].estimate %>' disabled>
                            <%}else {%>
                                <input class="form-control" type="text" name="estimate" id="estimate" value='<%= tasks[0].estimate %>' required>
                            <%}%>

                        <%}%>
                    </div>

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>

                    </div>

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Status</label>
                        <select name="status" id="status" onchange="selectChange()">
                            <%if(data.type == 1){%>
                                <% for (var i = 0;i<data.status.length;i++){%>
                                <%if(data.status[i].status_id == tasks[0].status_id){%>
                                <option value="<%=data.status[i].status_id%>" selected><%=data.status[i].description%></option>
                                <%} else {%>
                                <option value="<%=data.status[i].status_id%>"><%=data.status[i].description%></option>
                                <%}%>
                                <%}%>
                            <%} else {%>
                                <% for (var i = 0;i<data.status.length-2;i++){%>
                                <%if(data.status[i].status_id == tasks[0].status_id){%>
                                <option value="<%=data.status[i].status_id%>" selected><%=data.status[i].description%></option>
                                <%} else {%>
                                <option value="<%=data.status[i].status_id%>"><%=data.status[i].description%></option>
                                <%}%>
                                <%}%>
                            <%}%>


                        </select>
                        <input class="form-control" type="text" name="sttdesc" id="sttdesc" value='' style="display: none" >
                    </div>

                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Approved</label>

                        <%if(data.type == 1) {%>
                        <select name="approved" id="approved">
                            <option value="N" selected>No</option>
                            <option value="Y">Yes</option>
                            <option value="D">Deny</option>
                        </select>
                        <%} else {%>
                        <select name="approved" id="approved" disabled>
                            <option value="N" selected>No</option>
                            <option value="Y">Yes</option>
                        </select>
                        <%}%>
                    </div>
                    <input type="text" name="creator_id" id="creator_id" value='<%= tasks[0].reporter_id %>'style="display: none">

                    <input type="text" name="project_id" id="project_id" value='<%= tasks[0].project_id %>'style="display: none">

                    <input type="text" name="action" id="action" value = 'edit' style="display: none">
                    <div class="form-group form-group-icon-left"><i class="fa fa-user input-icon input-icon-show"></i>
                        <label>Creator</label>
                        <input type="text" name="creator" id="creator" value='<%= tasks[0].reporter_firstname + ' '+tasks[0].reporter_lastname %>' required disabled>



                        </br>
                        <input class="btn btn-primary" value="Add" id="add" type="submit" >

                    </div>

                </form>


            </div>
            <div class="col-md-8">
                <h3>Work Log</h3>

                <hr>
                <div class="row" data-gutter="60" style="overflow: scroll">
                    <div class="row" data-gutter="60">
                        <div class="col-md-4">
                            <h4>Date</h4>
                        </div>
                        <div class="col-md-3">
                            <h4>Name</h4>
                        </div>
                        <div class="col-md-5">
                            <h4>Description</h4>
                        </div>
                    </div>
                    <%for (i = 0 ; i <data.tasks.length ; i++){%>
                    <div class="row" data-gutter="60">
                        <div class="col-md-4">
                            <label><%= data.tasks[i].update_time%></label>
                        </div>
                        <div class="col-md-3">
                            <label><%= data.tasks[i].userfirstname+' '+data.tasks[i].userlastname +' ('+ data.tasks[i].useremail +' )'%></label>
                        </div>
                        <div class="col-md-5">
                            <label><%= data.tasks[i].action_description%></label>
                        </div>
                    </div>
                    <hr>
                    <%}%>

                </div>

            </div>

        </div>
    </div>


    <div class="gap"></div>
    <footer id="main-footer">
    </footer>


    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/slimmenu.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/bootstrap-timepicker.js"></script>
    <script src="js/nicescroll.js"></script>
    <script src="js/dropit.js"></script>
    <script src="js/ionrangeslider.js"></script>
    <script src="js/icheck.js"></script>
    <script src="js/fotorama.js"></script>
    <script src="js/typeahead.js"></script>
    <script src="js/card-payment.js"></script>
    <script src="js/magnific.js"></script>
    <script src="js/owl-carousel.js"></script>
    <script src="js/fitvids.js"></script>
    <script src="js/tweet.js"></script>
    <script src="js/countdown.js"></script>
    <script src="js/gridrotator.js"></script>
    <script src="js/custom.js"></script>
</div>
</body>
<script type="text/javascript">
    $(document).ready(function () {
        $('#email').keyup(function () {
            $(".error").remove();
            var obj = $(this);
            if (obj.val().trim() != '') {
                $.ajax({
                    type: "POST",
                    url: "./ajax/checkEmailAddProject",
                    data: "mode=checkEmailAddProject&email=" + obj.val(),
                    success: function (msg) {
                        //alert(msg);
                        data = msg;
                        if (data.status == 'exist') {

                            document.getElementById('name').value = data.name;
                            document.getElementById('realname').value = data.name;
                            document.getElementById('assignee_id').value = data.user_id;
                            document.getElementById('add').style.display = 'block';
                        }
                        else {
                            document.getElementById('name').value = '';
                            document.getElementById('realname').value = '';
                            document.getElementById('add').style.display = 'none';

                        }
                    }
                });
            } else {
                document.getElementById('add').style.display = 'block';
            }

        });

    });

    $(document).ready(function () {
        $('#code').keyup(function () {
            $(".error").remove();
            var obj = $(this);
            $.ajax({
                type: "POST",
                url: "./ajax/checkProjectCode",
                data: "mode=checkProjectCode&code=" + obj.val(),
                success: function (msg) {
                    //alert(msg);
                    data = msg;
                    if (data.status == 'exist') {
                        obj.after("<label class='error'>Project Code Is Aleady Exist</label>");
                        document.getElementById('add').style.display = 'none';
                        /*$("#frmId .btn").attr('disabled', 'disabled');*/
                        /* document.getElementById('name').value = data.name;*/
                        /*document.getElementById('add').style.display = 'block';*/
                    }
                    else {
                        /* $("#frmId .btn").removeAttr('disabled');*/
                        document.getElementById('add').style.display = 'block';
                    }
                }
            });
        });

    });
</script>
<script language="javascript">
    $("#approved").val('<%=tasks[0].approved%>');
    if (document.getElementById('email').value.trim() == '') {
        document.getElementById('add').style.display = 'block';
    }
    function  buttonAdd() {
        var value = getSearchParams('project_id');
        document.getElementById('project_id').value = value;
    }
    function getSearchParams(k){
        var p={};
        location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(s,k,v){p[k]=v})
        return k?p[k]:p;
    }

    function ChangeThis(){
        var value = document.getElementById('email').value;
        if(value != ''){
            document.getElementById('assignee_id').value = "<%=data.userid%>";
            document.getElementById('name').value = "<%= data.fname + ' '+data.lname%>";
            document.getElementById('realname').value = "<%= data.fname + ' '+data.lname%>";
        }else{
            document.getElementById('assignee_id').value = "0";
        }

    }
    function  selectChange() {
        var value = document.getElementById('status').value;
        if(value == '1'){
            document.getElementById('sttdesc').value = 'Open';
        }
        if(value == '2'){
            document.getElementById('sttdesc').value = 'In Progress';
        }
        if(value == '3'){
            document.getElementById('sttdesc').value = 'Resolved';
        }
        if(value == '4'){
            document.getElementById('sttdesc').value = 'Reopen';
        }
        if(value == '5'){
            document.getElementById('sttdesc').value = 'Paid';
        }
    }
    /* function DoPost() {

         var varTaskCode = document.getElementById('taskcode').value;
         var varDescription = document.getElementById('description').value;
         var varAssignee = document.getElementById('userid').value;
         var varEstimate = document.getElementById('estimate').value;
         var varLog = document.getElementById('log').value;
         var varStatus = document.getElementById('status').value;
         var varApproved = document.getElementById('approved').value;
         var varCreator = document.getElementById('creator').value;

         if (varDescription.trim() == '') {
             $(".error").remove();
             $(document.getElementById('description')).after("<label class='error'>This Is Mandatory Field</label>")
         } else {
             $.post("save-task", {
                 taskcode: varTaskCode,
                 description: varDescription,
                 assignee_id: varAssignee,
                 estimate: varEstimate,
                 log: varLog,
                 status: varStatus,
                 approved: varApproved,
                 creator: varCreator,
                 creator_id: document.getElementById('creatorid').value,
                 project_id: getSearchParams('project_id'),
                 action : 'save'
             });  //Your values here..
         }

     }*/

</script>
</html>

